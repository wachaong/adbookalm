\newpage

\begin{CJK*}{GBK}{song}

\setcounter{chapter}{1}
\setcounter{section}{0}

\chapter{竞价时代}

\thispagestyle{empty}
\markboth{竞价时代}{竞价时代}

随着受众定向技术的发展，以及搜索业务变现的要求，在显示广告和搜索广告中都产生了竞价这种新的交易模式。如果我们对比前面的合约广告，竞价交易模式的本质，是将量的约束从交易过程中去除，仅仅采用“价值高者得”的决策方案来投放广告。竞价顺应了定向广告向精细化发展的趋势要求，也为大量无法用合约形式售卖的剩余流量找到了可能的变现渠道，使得大量中小广告主的参与在线广告的可能性和积极性大大增强，也是的在线广告的商业环境与线下广告产生了本质的区别。

在竞价的市场环境中，产生了广告网络这种批量采购各种媒体剩余流量，然后主要按照点击付费的方式售卖给需求方的产品形式。这种产品形态对于提高整个在线广告市场的流动性发挥了很大作用。如何设计合理的市场规则和定价策略，使得整个市场的竞争更加充分，对于广告网络运营者的收益有相当大的影响。这方面有关宏观市场上的讨论，在竞价时代显得非常重要，也成为在线广告领域得到充分重视和深入研究的问题，我们在本章中会对这方面的理论和实用方法做适当的回顾。这也是合约广告系统中不存在的问题，充分认识定价策略背后的意义，对于把握竞价广告系统的本质非常关键。

竞价广告中，计算的作用更加突出，这一方面是因为竞价本身需要对eCPM做尽可能准确的估计，也是因为中小广告主的规模使得计算的效率要求很高。具体而言，有两项技术非常关键：一是当大量中小广告主参与市场后，如何根据广告的一些业务要求设计更高效合理的索引和检索技术，这部分将是本章展开讨论的重点；二是为了完成eCPM估计，对给定$(a,u,c)$组合上的点击率预测技术。另外，由于大量中小广告主的参与，竞价广告系统中对eCPM的估计往往面临统计不足的情形。如何设计有效的策略探索未知领域，并利用探索的结果更好的估计eCPM，也是一个非常有趣的问题。由于eCPM估计本身是整个广告生态系统中非常核心的计算问题之一，我们将在下一章中对这方面的算法做专门的探讨。

对应于广告网络的产生，需求方的产品和技术也在发生变化。关键的变化有两点：一是由面向广告位采买变成面向人群的跨网络采买；二是帮助广告主在竞价环境中完成量的要求，这一点是竞价市场不再直接保证的。能达到这些需求方目的的产品，我们叫做交易终端。在交易终端里，在量的约束下完成ROI的优化的问题依然存在，并且变得比在线分配问题更加困难，这也成为高端的采买平台提供的服务之一。

搜索广告的商业形态，与显示广告网络本质上是一样的，都是按照点击结算的竞价广告市场，因此本章中有关宏观市场和检索技术方面的讨论同样适用于搜索广告。不过由于搜索问题的特殊性，以及搜索广告重要的商业地位，对它的技术探索有很多深入定制化的部分，这些特殊的地方我们将在第七章中做专门介绍。

\section{竞价的位置拍卖理论简述}
竞价广告是象拍卖那样销售广告。也就是根据广告主的出价，以及由此计算出的期望收益，决定谁可以得到某次展示的广告位。在竞价广告产生的开始阶段，出价是广告主阶段性调整的，而到了广告交易市场阶段，广告主可以对每次展示实时调整出价\footnote{实时竞价的具体产品和技术将在第八章中介绍。}，这两种方式从拍卖市场的宏观角度看，没有本质差别。

让我们先来看看怎么具体描述竞价广告问题，并从宏观市场的角度了解一些非常重要的结论。假设有一组广告位可以被占用，将这些广告位按照其经验价值排名，分别记为$s={1, 2, \cdots, S}$，对Banner广告而言，这里的$S$一般为1。在某次广告请求中，有一组广告$a={1, 2, \cdots, A}$出价参与拍卖，每个广告的出价记为$b_a$，系统将前$S$ 个高出家的广告依次放到前面排序好的$S$个广告位上，这样的问题称为\begin{CJK*}{GBK}{kai}{位置拍卖(Position Auction)}\end{CJK*}。根据前文的讨论，当某个广告$a$ 被放在$s$ 位置上时，其期望收益即即eCPM为$r_{as}=\mu_s \nu_a$。这里我们做了一些假设，比如点击率$\mu$仅与位置$s$有关，而点击价值$\nu$仅与广告$a$ 有关，这些假设在搜索广告给定某具体关键词的情形下，可以说基本合理，对于显示广告的情形虽然非常粗略，但并不太影响对竞价问题宏观市场的讨论。

围绕位置拍卖最重要的研究，是广告的\begin{CJK*}{GBK}{kai}{定价(Pricing)}\end{CJK*}问题。定价问题探讨的是在一次具体的拍卖交易中，给定各参与者的出价，以及他们的期望收益，如何对最后获得某个位置的广告商收取合适的费用。乍听起来，讨论这个问题有点多余，按照广告主自己的出价收取不就可以了么？为了阐释清楚此项研究的动机，我们先来看看下面的例子：假设有某个单位置($S=1$)的广告机会在竞拍，开始有两个广告主参与，甲出价1元，乙出价2元，当然甲赢得了此次竞价，如果按照其出价来收费，市场就向他收取2元的费用。在广告市场里，这一拍卖机会还会重复出现(对应于不断产生的展示)，因此广告主可以也存在调整出价的机会，假设乙在发现自己2 元钱能拿到流量以后，自然就会想到，是不是可以调低出价，用更低的成本拿到流量？乙将一直不断尝试，知道把出价调低到1.01元，发现继续调低就拿不到位置了。于是系统稳定在甲出价1元，乙出价1.01元。此时假设又有一个广告主丙加入竞争，并希望赢下此广告位，那么以此类推，他在不断调整后将会出价1.02元，市场的收入也就是1.02 元。我们有可能通过调整定价策略来影像系统的总收益么？这样的机会显然存在。比如我们在甲出2元，乙出1元参与竞价时，并不对获胜的甲收2元，而是收取其下一名即乙的出价1 元，那么甲就没有动力调低其出价了。那么当丙加入时，就需要出价2元以上才可以赢得竞价，市场的收入也就变成了2元(不论丙出价多少，我们都按其下一位即甲的出价来收费)。这个简单的例子告诉我们，在广告这样的参与者可以针对同一个标的物不断调整出价的拍卖环境中，通过聪明的定价策略，完全可能为整个市场创造更高的收益以及其他好处。

在定价问题上，我们在微观上的直觉未必可以推广到宏观市场。让我们来看看如何对上面的位置拍卖问题作进一步探讨。从整个市场的角度来看，我们重点需要研究的是市场处于稳定状态下的收益和其他情况。而所谓稳定，指的是整个竞价系统处于纳什均衡(Nash Equilibrium)状态，也即每个广告商都通过出价得到了最符合自己利益的位置。对某一次位置竞价来说，其对称纳什均衡(Symmetric Nash Equilibrium)状态可以表示为下式：
\begin{eqnarray}\label{SNE}
\mu_s(\nu_s - p_s) &\geq& \mu_t(\nu_s - p_t), \forall t > s \nonumber \\
\mu_s(\nu_s - p_s) &\geq& \mu_t(\nu_s - p_{t-1}), \forall t < s
\end{eqnarray}
注意这里的下标意义有所调整，这里的$\nu_s$指的是排在$s$位置上的广告上的点击价值，并非$s$位置带来的点击价值；而$p_s$指的是市场向排在$s$位置上的广告收取的费用，即定价。这一均衡状态的意义很容易理解：对于最终位置排名竞价结果中的每一条广告，其收益都比排在其他位置上要高。显然，在这样的状态下，每个广告商都达到了自己最优的状态，整个系统也就随之稳定下来。

在公式\ref{SNE}中，市场方能够调整的策略，只有$p_s$的确定方式，也就是定价策略。随着定价策略的不同，市场达到稳定状态时的宏观收益情况和稳定的程度都有所不同。因此，有关竞价市场宏观性质的研究，主要目的是寻找更好的定价策略以优化整体收益。关于位置竞价问题纳什均衡状态的数学分析，由于与本书的产品和技术重点有一定差距，因此不再介绍这方面的内容，有兴趣的读者可以阅读文献\cite{Varian}。我们只介绍两种竞价市场用到的定价策略，以及与宏观市场相关的几个策略问题。

\subsection{GSP}

在线广告竞价市场最常见的定价策略，是广义第二高价(Generalized Second Pricing, GSP)策略；另外有一种VCG(VickreyCClarkeCGroves)定价策略，虽然理论上比GSP更好，但是由于原理较复杂，向广告主解释起来有难度，因此在实用系统中采用的并不多。下面我们分别介绍一下这两种定价策略。

先来看看是么叫第二高价(Second Pricing)。所谓第二高价，指的是在位置拍卖中，向赢得某个位置的广告商收取其下一位广告主的出价。如果是按照CPM结算，那么第二高价就可以直接应用了。需要考虑的问题是，在CPC计算的竞价广告系统中，广告主的出价是针对点击的，而竞价是针对eCPM的，因此要对两者做一下换算以实现公平的第二高价，这就是所谓的广义第二高价，其定价公式为：
\begin{eqnarray}\label{GSP}
p_s = \mu_{s+1} b_{s+1} \big/  \mu_s + \Delta
\end{eqnarray}
如果将等式两边同时乘以$\mu_s$，可以看出广义第二高价实际上仍然是eCPM上的第二高价。读者也可以自行验证，在广义第二高价情形下，对某广告主的定价是一定不会大于其出价的。实际上，这种定价策略也同样适用于CPS结算的竞价市场，并且只需要将公式中的$\mu$换成$\mu\nu$即可。公式最后的$\Delta$，一般为广告系统结算货币的最小单位，比如1美分，这是一种历史惯例，也在某种程度上让广告主心理上感觉更加公平。

对比上面提到的竞价广告的例子，可以直觉地知道，广义第二高价可以基本上满足市场稳定情形下收益优化的需求。不过需要说明的是，这种满足只是直觉上的而非理论意义下最优的，这一点读者可以对比下面介绍的VCG定价策略来理解。虽然并非理论上最优，广义第二高价却有着实现简单、容易向广告主解释等诸多操作中的优点，因此在实际的竞价广告系统中是最主流的定价策略。

\subsection{VCG}
VCG定价是Vickrey, Clarke和Groves在研究竞价系统均衡状态时得到的一种理论上较为优越的定价策略。其基本思想是：对于赢得了某个位置的广告主，其所付出的成本应该等于他占据这个位置给其他市场参与者带来的价值损害。在这一原则下，VCG的定价策略可以表示为：
\begin{eqnarray}\label{VCG}
p_s = \sum_{t>s} (\mu_{t-1} - \mu_{t}) \nu_t
\end{eqnarray}

这种定价策略直觉上的合理性很容易理解。实际上，理论分析表明，VCG定价策略的优越性体现在如下几个方面：首先，在这种定价策略的稳定状态下，整个市场是truth-telling的。所谓truth-telling，可以理解为每个广告主都找到了自己的最优状态。其次，相对于其他的定价策略，这种定价向广告主收取的费用是最少的。

虽然有以上诸多的有点，VCG定价在在线竞价广告中却并不是一种主流的方式。究其原因，主要是由于这种定价方式的逻辑过于复杂，比较难以向广告主解释清楚；另外在广告主和媒体存在博弈关系的情形下，媒体是否正确地计算了“给其他市场参与者带来的价值损害”也很难验证。不过这种定价方法也有其市场空间，有的广告厂家，比如Facebook，在实际的系统中采用了这一定价方法。

\section{按点击付费的竞价系统之崛起}
\subsection{广告联盟模式}

对显示广告而言，合约式的售卖方式必然无法消耗所有的库存，实际中由于为了控制售卖比例已获得更高的品牌溢价空间，这样卖不出去的广告流量可能比我们想象得更多，这部分流量，我们称为\begin{CJK*}{GBK}{kai}{剩余流量(Remnant Inventory)}\end{CJK*}。竞价交易模式的产生，为这部分流量提供了变现的机会，于是产生了广告网络这一产品形态。

广告网络的基本业务，是批量聚合各媒体的剩余流量，按照人群或上下文标签的流量切割方式售卖给广告主。由于是按人群售卖，广告网络会极力淡化广告位的概念。另外，广告网络一般不会向广告主约定或保证能够买到的量，而只是根据变现能力来决定每次展示分配给哪个广告主。与合约式的广告系统不同，广告网络使得为了保证合约而设计的复杂的在线分配算法必要性大大降低(如前文所述，在优化的意义上，在线分配技术对于广告网络依然很有价值，但已不再是必需的技术)，使得其中的计算技术可以把精力集中在对eCPM 的估计上。从商业角度来看，广告网络的销售模式与合约的方式相比，也有两点优势：首先是无需再满足广告主品牌独占的要求，这使得让国美和苏宁同时参与同一个人群的竞价，提高市场流动性成为可能，而在合约广告中，这一点是很难做到的。其次，由于广告网络不再保证量，二是根据实际消耗来结算，一般来说财务上采用广告主先充值的方式，这区别于合约广告投放结束后计算的方式，结果使得广告网络运营方的现金流状况大为改善。

广告网络的存在CPM、CPC和CPS等不同的结算方式，不过最主流的方式是CPC。从计算的角度，我们非常有必要分析一下为什么CPC是最合适的。首先从Demand来看，既然是各种媒体的不同广告位聚合在一起售卖，广告主无法知道每个媒体上广告的具体位置。而根据我们前面的讨论，位置对于广告的曝光效果影响巨大，因此实际上广告主根本无法评估每次展示的出价，而在点击上出价，这个问题就没那么严重了。另外从Supply来看，由于淡化广告位的概念，并且聚合了多个媒体的流量，广告网络可以接触到同一个用户比较丰富的网络行为，并且知道每次展示所在的媒体与广告位位置，所以比广告主更容易估计点击率。根据第一章中的讨论，由广告网络负责估计点击率，需求方根据对点击价值的估计来出价，是最合理的市场分工。

一般来说，广告网络中的投放决策过程对媒体而言都类似于一个黑盒子：媒体只需要在广告位上加上广告网络的JS代码，而无需也无法关心每次展示的投放结果。但是对于一些有特殊业务需求，或者特殊数据来源的媒体或媒体组合来说，有时候希望能够直接从广告网络的广告库中挑选广告，并能够创造比广告网络自动挑选更多的价值。因此，某些广告网络也会对一部分合作供给方开放广告库供其自行挑选，广告网络的这种运营模式，我们可以称为联盟(Affiliate)模式。

\subsubsection{代表案例介绍:Google Display Network，阿里妈妈}

实际的广告网络有两种不同的业务方向，一中是广泛承接各种广告库存，并面向所有品类的广告主进行服务，我们称之为水平广告网络；另一种则专门服务于某一种类型的广告主，例如电商、游戏等，并寻找相关的媒体资源来搭建网络，我们称之为垂直广告网络。下面我们分别举一个例子来介绍这两种类型的广告网络。

Google自从Adsense进入上下文广告领域后，又于2008年收购了显示广告领域的巨头Doubleclick。在整合旗下Utunbe、Google Finance、以及Adsense等一些广告资源基础上，退出了Google Display Network这一显示广告领域最重要的广告网络之一。

由原来Adsense这种为搜索广告的衍生产品存在的地位，进化到独立的GDN，表现出Google对显示广告领域的重视和独立发展的决心。

\begin{figure}\label{fig_google}
\centering
\scalebox{0.6}
{
    \includegraphics[width=1.65\textwidth]{google.eps}
}
\caption{Google在显示广告领域的布局}
\end{figure}

除了GDN，Google还通过收购等方式，在显示广告领域从供给端到需求端进行了全系列的布局。从LUMA的显示广告市场图中，我们把Google的部分产品和子公司标示出来，可以更清晰地了解这一布局：

\subsubsection{阿里妈妈联盟}

阿里妈妈是阿里巴巴集团旗下的广告产品之一，目的是为了利用淘宝和天猫网以外的网站为阿里巴巴平台上的卖家带来流量和转化，并且根据转化的比例给网站一定的佣金。由于阿里妈妈平台上的广告主基本上都是淘宝和天猫的网店，因此可以把它看成是一个面向电商类型广告主的垂直广告网络。

加入阿里妈妈网络的媒体，主要是为淘宝等商家带来流量，因此阿里妈妈把它们称为“淘宝客”。淘宝客网站有两种方式利用阿里妈妈联盟中的广告需求变现：一种方式是像普通的广告网络那样，直接在广告位上加一段阿里妈妈的广告投放代码，由阿里妈妈的广告服务器来进行广告决策；另一种方式，是淘宝客网站通过API拿到相关的广告，并自行决定在某个页面、或对某种用户展示的什么样的商品=，这种方式是其他的广告网络没有的。乍看起来，由于阿里妈妈掌握的用户数据和运算能力远远超过一个个孤立的淘宝客网站，让阿里妈妈负责广告决策，应该可以达到更好的eCPM，不过由于电商广告网络特殊的性质，一些购物导航或购物分享类型的个人博客或网站，可以通过后一种手段，利用软文的形式非常有针对性和全面地介绍和宣传某种产品，而这种软文广告能达到的效果远远高于普通的在线广告。因此，这种将广告库开放，由淘宝客网站自行选择广告的方式，其变现能力在充分优化后也相当可观。不过由于后一种方式无法规模化，并且通常只在转化流程相当完善的情形下才有意义，因此并不见得适用于一般的广告网络，但在电商垂直广告网络中是不错的方式。

由于在阿里巴巴的生态系统中大量天然广告需求的存在，并且可以收集到用户非常接近于转化的高价值行为数据，阿里妈妈的精准广告投放能力和市场竞争程度，都是非常高的。

\subsection{搜索广告模式}
从商业逻辑和产品形态上看，搜索广告可以认为是广告网络的一个特例。它是以上下文查询词为粒度进行受众定向，并按照竞价方式售卖和CPC结算的广告网络。从检索、点击率预测等关键环节的技术上看，搜索广告与显示广告网络并没有本质的区别。不过，由于搜索广告本身的变现能力，即eCPM远远高于显示广告，因此其市场重要程度也就得以彰显。对与搜索广告的一些独特问题和算法的研究，也就受到了非常高度的重视。在本章中，我们将在前一章讨论的竞价广告系统的基础上，着重探讨搜索广告相关的一些特殊问题。

搜索广告与一般广告网络最主要的区别，是上下文信息非常强，因此用户标签的作用受到很大的限制。因此，关于搜索广告的研究，有两个技术上的重点：一是查询词的扩展，即如何对简短的上下文信息做有效的拓展，由于搜索广告的变现水平高，这样的精细加工是值得而且有效的；二是根据用户同一个搜索session内的行为对广告结果的调整，因为围绕同一个目的一组搜索，往往对于更准确地理解用户意图有很大帮助。本章中，我们将围绕这两个重点问题，概要性的介绍搜索广告中的思路与具体技术。

尽可能快速地将用户搜索行为反馈到广告决策中的需求，催生了流式计算平台。这一技术与Hadoop这样的离线分布式计算平台相呼应，可以更有效地完成计算广告中的数据处理任务：对于那些长时期积累的海量用户行为数据，我们可以用Hadoop进行离线的、实时性不强的定期挖掘；对于那些短时用户行为，可以用流计算平台进行半实时加工和快速反馈，以便迅速指导线上决策。这样的计算分工和系统架构，其实不仅适用于搜索广告，也适用于显示广告网络里的短时受众定向和短时用户行为反馈。

对搜索广告这个产品，不同搜索引擎提供商有不同的称呼，比如Paid Search, Search Ad, Sponsored Search等。这些词汇概念上非常相似，但也略有差别，个人比较倾向于采用“Sponsored Search”这样的说法，而“Paid Search”有时会让读者对是谁付费产生误解。至于“Search Ad”，实际上还应包括搜索引擎中的其他广告形式，比如百度品牌专区，因而并不是本章讨论的狭义的完全竞价的搜索广告网络。


本章中讨论的搜索广告，主要以通用搜索引擎为蓝本。实际上，很多垂直类搜索，特别是电子商务类搜索也有很强的广告变现能力，但产品形态可能会有所不同，大家可以有选择性地与下面讨论的问题来对照。另外，插入在自然搜索结果中的竞价排名模式，也不在我们讨论的范围内。

如下图所示，搜索广告的展示区域，一般来说分为北(North)、东(East)、南(South)三个部分。北侧和东侧的所有位置，构成位置拍卖的标的物集合，但是并不是一定要在这些位置上出广告，这一点与显示广告有的区别。南区的广告，不同的搜索引擎有不同的产品处理方法，有的直接照搬北区广告，有的则直接照搬东区的前几条，在本章中不做讨论。一个搜索广告位置的示例如图\ref{fig_ss}所示。从这个示例可以看出，搜索广告是一个非常典型的位置竞价问题，就期望点击率而言，北显著高于东区，而同区当中位置越靠上也越高，因此，竞价时位置的排序为$\{\textrm{North}_1, \textrm{North}_2, \cdots, \textrm{East}_1, \textrm{East}_2, \cdots\}$，有一点特殊之处是，每次拍卖时的位置数目，是可以跟据广告相关性来动态调整的。

\begin{figure}\label{fig_ss}
\centering
\scalebox{0.65}
{
    \includegraphics[width=1.4\textwidth]{ss.eps}
}
\caption{搜索广告竞价位置示例}
\end{figure}

搜索广告的受众定向标签，即是上下文的搜索词。由于搜索词非常强地表征着用户的兴趣，搜索广告可以进行非常精准的定向。相对这样的上下文信息，根据用户历史行为得到的兴趣标签重要性大打折扣，这一方面是因为其信号远不如上下文搜索词强烈，另一方面是因为用户这样强烈兴趣的任务是绝不能被打断的(参见第二章中广告有效性原理部分)。这是搜索广告区别于显示广告网络的最大特点。

既然搜索词的重要性极高，粒度又非常细，如何根据广告主的需求对其关键词进行合理的拓展，找到那些相关而又效果不错的关键词，这对于需求方和供给方来说都有很大意义：需求方需要通过扩展关键词以拿到跟多流量；供给方则需要借助此来变现更多流量和提高竞价的激烈程度。因此，查询扩展(Query Expansion)是搜索广告的重要技术。搜索广告的查询扩展，与搜索中的这个问题，有相通之处，又有一些显著的区别。

虽然按照用户历史行为做定向不适用于搜索广告，用户在一个session内的一系列查询，还是会对准确理解用户意图大有帮助。另外，前一章介绍的点击反馈特征，也存在着快速更新的需求。要达到这两个目的，系统上的挑战要大一些，原先那样基于Hadoop的离线挖掘模式就不适用了。正是这一需求的存在，催生了流式计算(Stream Computing) 的技术平台，目的是利用用户短时的行为快速、连续地得到一些统计信息，并反馈给线上决策系统。流式计算对于广告中许多问题都非常有用，我们以搜索广告为出发点，拓展讨论到这一技术在显示广告短时用户行为反馈中的用处。


\subsubsection{代表案例介绍:Google，Baidu}
\subsection{广告购买平台}
竞价广告市场的产生，对需求方的技术也提出了新的要求：原来通过直接与媒体签订保量合约的采买方式，需要让位于通过参与竞价帮助广告主完成量与质需求的采买产品。具体地说，这样的产品需要具备一项基本功能：即按照广告主预算跨媒体和广告网络一站式采买某种人群的广告投放机会。另外，还可以具备一项高级功能，即机器驱动的自动ROI优化功能。这样的产品形态，我们称为媒体采买平台(Media Buying Platform, MBP)，与之类似的概念，还有所谓交易终端(Trading Desk)，可以认为是同一类的产品。

从市场发展来看，许多媒体采买平台都是4A或其他代理公司为了适应市场技术形态的变化，收购或者孵化出来的子公司，这从图*中这两部分产品之间的连接线就可以看出来。值得注意，在竞价广告市场上，广告主量的需求仍然是存在的，因此保量的合约并不是消失了，而是由代理与媒体之间下沉到了广告主与媒体采买平台之间。

媒体采买平台的技术挑战主要在于ROI的优化部分，要合理地选择需要的受众定向条件，并在每个人群上优化出价，以保证量的要求和优化收益，是一个复杂的组合优化问题。由于无法具体控制每一次展示，其困难程度要高于后文实时竞价的情况下的DSP优化。这方面的市场需求，以搜索广告网络中的优化问题最为突出，因此我们将在下一章中具体介绍相关技术。
\subsubsection{非RTB的流量的ROI优化简述:SEM,SEO}
搜索广告对应的需求方问题，即通过竞价采买搜索引擎关键词来做广告的问题，我们称之为搜索引擎营销(Search Engine Marketing, SEM)。从本质上看，SEM与前文提到的媒体采买平台面临的挑战类似，即流量选择(此处为关键词选择)和出价。不过对SEM来说，各个标签即关键词的流量是互相不重叠的，这与显示广告受众定向标签之间可以做复杂的布尔运算不同。

关键词选择和出价两个问题都有相当的难度。首先来看关键词选择，如果广告上提供一些种子词(这一点往往是比较容易做到的)，那么这个问题看起来非常类似于\ref{q_exp}中的查询扩展问题。但是从市场地位上来看，又有着相当大的不同：搜索广告运营方进行查询扩展的目的，是为了提高自己的营收；而需求方进行关键词选择的目的，是为了提高广告主采买流量的ROI。这两个目标显然有着很大的区别，因此广告主更信赖代表需求方利益的SEM公司。不过SEM公司由于数据来源的问题，通过\ref{q_exp} 中讨论的各种方法都需要长期的数据积累才能实现。而出价的问题，传统的认识是广告主根据到达率、自己网站的转化率和客单价来估计点击价值，并以此点击价值为参考来出价。不过这种认识忽略了一个问题，那就是各个关键词的转化率、客单价和市场竞争水平都有很大的区别，因此只有在不同关键词上做不同的出价，才能更深入地优化整体采买的ROI。由于搜索广告的定向粒度很细，可以看出关键词选择和出价都是规模很大的优化问题，而且由于广告网络半封闭的竞价机制，数据的反馈和调整都不够及时，因此这一优化问题技术挑战是比较大的。这种面向广告网络中非RTB流量的ROI优化，也成为广告技术产品的一个重要方向。
\subsubsection{代表案例介绍: SEM公司,SEO公司,Efficient frontier}

Efficient Frontier开始是一家专门从事SEM优化的广告技术公司，后来也涉足显示广告网络的优化领域。现在已经被Adobe旗下的Omniture所收购，其产品成为Adobe Digital Market Suite中的一部分，称为Adlens。

从Efficient Frontier这家公司的名称，就可以大致了解到其技术方向。Efficient Frontier，是量化金融领域的术语，这一属于产生于著名的投资组合选取(Portfolio Selection)理论\cite{Markowitz}，这是通过计算的方法确定一个投资组合中各个品种的投资比例，以达到期望收益最优情况下风险最小的理论。在各个投资期望收益水平下，相应的最小组合风险对应的曲线，就称为Efficient Frontier。图*中给出了Efficient Frontier的一个示例。

如果将搜索广告里的标的物，即关键词，类比于股票，那么在一定预算的限制下分配各个关键词上的投入，以求达到整体ROI的最优，从框架上看非常类似于上述的Portfolio Selection问题。因此，Efficient Frontier公司按照这一思路，将量化金融里的Portfolio Selection理论与计算广告技术结合起来，创造性地发展出了大规模的关键词出价优化技术。
\section{应运而生的计算广告核心技术}
\subsection{广告系统的检索技术}
竞价广告市场中，大量中小广告主的参与，以及复杂的定向条件，对检索技术提出了更高的要求。倒排索引是搜索引擎的关键技术，而广告的检索上也采用这样的框架。但是广告的检索问题也有一些自身的特点和需求，我们需要讨论一下这些需求下一些专用的检索技术。在合约式广告系统中，广告主数目一般来说不算太大，因而采用一般的检索方案完全可以满足要求；然而在服务大量中小广告主的广告网络中，探讨高效且精准的检索技术，有非常切实的产品意义。

第二章中介绍的基本倒排索引技术在广告问题上遇到了两个挑战：一是广告指定的定向条件组合，可以看成是一个由与或关系连接的布尔表达式，这样的布尔表达式的检索，很显然与上面搜索引擎对文本的“bag of words”假设不太一样；二是在上下文和用户兴趣信号比较丰富时，广告检索中的查询可能相当长，甚至会由上百个关键词组成，这种情况下的检索，也与搜索引擎之中主要由1-4个term 组成的query情形有区别：试想你把100个关键词同时输入到搜索框中，返回的结果会是你想要的么？根据这些切实的需求，我们来讨论一下在线广告系统中的检索技术。
\subsection{点击率预测模型}
计算广告中一项非常重要的技术是点击率的预测。在竞价广告的环境下，估计点击率的目的是与点击价值(对广告网络而言即是CPC计费时的bid)相乘得到eCPM，再根据eCPM 对广告进行排序。从这里可以看出，广告的点击率估计与搜索里的排序问题有关联，但又有明显的不同：点击率估计不能像像搜索排序那样只要求结果排序的正确性。这一是因为点击率需要乘以bid才得到最后的排序，二是因为对一些需求方技术平台而言，需要尽可能准确地eCPM用于出价。因此，作为各种广告系统中通用的一项技术，点击率预测更适合被建模成回归(Regression)问题而不是排序问题。
\clearpage{\pagestyle{empty}} %\cleardoublepage

\end{CJK*}
